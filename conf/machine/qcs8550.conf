#@TYPE: Machine
#@NAME: qcs8550
#@DESCRIPTION: Machine configuration for the development board, with Qualcomm QCS8550

require conf/machine/include/qcom-qcs8550.inc

MACHINE_FEATURES = "usbhost usbgadget alsa wifi"

KERNEL_IMAGETYPE = "Image"
KERNEL_DEVICETREE = " \
                      qcom/qcs8550-addons-aim300-aiot.dtb \
                      qcom/sm8550-qrd.dtb \
                      qcom/sm8550-mtp.dtb \
                      "

# Additional dtbo to overlay on top of kernel devicetree files
KERNEL_TECH_DTBOS[qcs8550-addons-aim300-aiot] = "qcs8550-cnss.dtbo qcs8550-display.dtbo qcs8550-graphics.dtbo"
KERNEL_TECH_DTBOS[sm8550-qrd] = ""
KERNEL_TECH_DTBOS[sm8550-mtp] = ""

EFI_ARCH = "aa64"
UKI_FILENAME = "uki.efi"
UKI_DTB = "0"

KERNEL_CMDLINE_EXTRA ?= "root=/dev/sda6 rw rootwait console=ttyMSM0,115200n8 pcie_pme=nomsi earlycon net.ifnames=0"

MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS += " \
    kernel-modules \
"

MACHINE_EXTRA_RDEPENDS += " \
    packagegroup-firmware-qcs8550 \
    wlan-devicetree \
    displaydevicetree \
    graphicsdevicetree \
"
QCOM_BOOTIMG_ROOTFS ?= "/dev/sda6"

OVERLAYFS_ETC_MOUNT_POINT = "/mnt/overlay"
OVERLAYFS_ETC_DEVICE = "/dev/disk/by-partlabel/overlay"
OVERLAYFS_ETC_FSTYPE ?= "ext4"
OVERLAYFS_ETC_USE_ORIG_INIT_NAME = "0"

PREFERRED_PROVIDER_virtual/libgles1 = "adreno"
PREFERRED_PROVIDER_virtual/libgles2 = "adreno"
PREFERRED_PROVIDER_virtual/egl      = "adreno"
PREFERRED_PROVIDER_virtual/libgles1-native = "mesa-native"
PREFERRED_PROVIDER_virtual/libgles2-native = "mesa-native"
PREFERRED_PROVIDER_virtual/egl-native      = "mesa-native"
PREFERRED_PROVIDER_virtual/libgl-native      = "mesa-native"
