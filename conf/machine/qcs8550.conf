#@TYPE: Machine
#@NAME: qcs8550
#@DESCRIPTION: Machine configuration for the development board, with Qualcomm QCS8550

require conf/machine/include/qcom-qcs8550.inc

MACHINE_FEATURES = "usbhost usbgadget alsa wifi"

KERNEL_IMAGETYPE = "Image"
KERNEL_DEVICETREE = " \
                      qcom/qcs8550-addons-aim300-aiot.dtb \
                      qcom/qcs8550-rb5gen2-hdk.dtb \
                      qcom/sm8550-qrd.dtb \
                      qcom/sm8550-mtp.dtb \
                      "

# Additional dtbo to overlay on top of kernel devicetree files
KERNEL_TECH_DTBOS[qcs8550-addons-aim300-aiot] = "qcs8550-cnss.dtbo qcs8550-display.dtbo qcs8550-graphics.dtbo"
KERNEL_TECH_DTBOS[sm8550-qrd] = ""
KERNEL_TECH_DTBOS[sm8550-mtp] = ""

EFI_ARCH = "aa64"
UKI_FILENAME = "uki.efi"
UKI_DTB = "0"

# Additional Kernel cmdline parameters
SDBG_CMDLINE = "${@d.getVar(oe.utils.vartrue('DEBUG_BUILD', 'slub_debug=FZP,zs_handle,zspage; FZPU', '', d))}"
KERNEL_CMDLINE_EXTRA ?= "root=/dev/disk/by-partlabel/system rw rootwait console=ttyMSM0,115200n8 pcie_pme=nomsi earlycon net.ifnames=0 ${SDBG_CMDLINE}"

MACHINE_ESSENTIAL_EXTRA_RRECOMMENDS += " \
    kernel-modules \
"

MACHINE_EXTRA_RDEPENDS += " \
    packagegroup-firmware-qcs8550 \
    wlan-devicetree \
    displaydevicetree \
    graphicsdevicetree \
"

QCOM_BOOTIMG_ROOTFS ?= "/dev/disk/by-partlabel/system"

OVERLAYFS_ETC_MOUNT_POINT = "/mnt/overlay"
OVERLAYFS_ETC_DEVICE = "/dev/disk/by-partlabel/overlay"
OVERLAYFS_ETC_FSTYPE ?= "ext4"
OVERLAYFS_ETC_USE_ORIG_INIT_NAME = "0"
